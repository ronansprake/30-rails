<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>30 Rails calculator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@600&display=swap" rel="stylesheet">
    <style>
      * { font-family: 'Open Sans', sans-serif; font-weight: 600; color: #444B53; }
      body { background-color: #F6F6F6; }
      .rail-label { font-size: 18px; }
      .rail-count, .rail-score, .mine-count, .mine-score, .total-score { font-size: 32px; }
      h1 { text-indent: -99em; position: absolute: width: 0; height: 0; }
      .rail-lines { list-style: none; margin: 0; padding: 0; }
      .rail-decrement, .rail-increment, .rail-bonus { background: none; width: 40px; height: 40px; font-size: 24px; border: none; cursor: pointer; }
      .rail-bonus { font-size: 18px; border: 1px solid #444B53; }
      .rail-bonus.on { background: #444B53; color: #FFF ;font-size: 18px; border: 1px solid #444B53; }
    </style>
  </head>

  <body>
    <h1>30 Rails roll and write score calculator</h1>
    <div class="rail-types">
      <div class="rail-type-1"></div>
      <div class="rail-type-2"></div>
      <div class="rail-type-3"></div>
      <div class="rail-type-4"></div>
      <div class="rail-type-5"></div>
      <div class="rail-type-6"></div>
    </div>

    <ol class="rail-lines">
      <li class="rail-line">
        <div class="rail-label">1 - 2 (1)</div>
        <div class="rail-count">
          <div class="rail-count js-rail-count">0</div>
          <button class="rail-decrement js-rail-decrement" data-rail="2">-</button>
          <button class="rail-increment js-rail-increment" data-rail="2">+</button>
        </div>
        <button class="rail-bonus js-rail-bonus" data-bonus="0">+2</button>
        <div class="rail-score js-rail-score">0</div>
      </li>
      <li class="rail-line">
        <div class="rail-label">1 - 3 (2)</div>
        <div class="rail-count">
          <div class="rail-count js-rail-count">0</div>
          <button class="rail-decrement js-rail-decrement" data-rail="2">-</button>
          <button class="rail-increment js-rail-increment" data-rail="2">+</button>
        </div>
        <button class="rail-bonus js-rail-bonus" data-bonus="0">+2</button>
        <div class="rail-score js-rail-score">0</div>
      </li>
      <li class="rail-line">
        <div class="rail-label">1 - 4 (3)</div>
        <div class="rail-count">
          <div class="rail-count js-rail-count">0</div>
          <button class="rail-decrement js-rail-decrement" data-rail="3">-</button>
          <button class="rail-increment js-rail-increment" data-rail="3">+</button>
        </div>
        <button class="rail-bonus js-rail-bonus" data-bonus="0">+2</button>
        <div class="rail-score js-rail-score">0</div>
      </li>
      <li class="rail-line">
        <div class="rail-label">2 - 3 (3)</div>
        <div class="rail-count">
          <div class="rail-count js-rail-count">0</div>
          <button class="rail-decrement js-rail-decrement" data-rail="4">-</button>
          <button class="rail-increment js-rail-increment" data-rail="4">+</button>
        </div>
        <button class="rail-bonus js-rail-bonus" data-bonus="0">+2</button>
        <div class="rail-score js-rail-score">0</div>
      </li>
      <li class="rail-line">
        <div class="rail-label">2 - 4 (4)</div>
        <div class="rail-count">
          <div class="rail-count js-rail-count">0</div>
          <button class="rail-decrement js-rail-decrement" data-rail="5">-</button>
          <button class="rail-increment js-rail-increment" data-rail="5">+</button>
        </div>
        <button class="rail-bonus js-rail-bonus" data-bonus="0">+2</button>
        <div class="rail-score js-rail-score">0</div>
      </li>
      <li class="rail-line">
        <div class="rail-label">3 - 4 (5)</div>
        <div class="rail-count">
          <div class="rail-count js-rail-count">0</div>
          <button class="rail-decrement js-rail-decrement" data-rail="6">-</button>
          <button class="rail-increment js-rail-increment" data-rail="6">+</button>
        </div>
        <button class="rail-bonus js-rail-bonus" data-bonus="0">+2</button>
        <div class="rail-score js-rail-score">0</div>
      </li>
    </ol>
    <div class="mine">
      <div class="mine-label">Mine (2/6/12/20)</div>
      <div class="mine-count">
        <div class="mine-count js-mine-count">0</div>
        <button class="mine-decrement js-mine-decrement">-</button>
        <button class="mine-increment js-mine-increment">+</button>
      </div>
      <div class="mine-score js-mine-score">0</div>
    </div>
    <div class="total-score js-total-score">0</div>
    <div class="overrides">
      <button class="override-1 js-override">Override 1</button>
      <button class="override-2 js-override">Override 2</button>
    </div>

    <script type="text/javascript">
const railScoreArray = [1,2,3,3,4,5];
const mineScoreArray = [0,2,6,12,20];

const elemTotalScore = document.querySelector('.js-total-score');

const elemOverrideControls = document.querySelectorAll('.js-override');

const elemMineCount = document.querySelector('.js-mine-count');
const elemMineScore = document.querySelector('.js-mine-score');
const elemMineIncrement = document.querySelector('.js-mine-increment');
const elemMineDecrement = document.querySelector('.js-mine-decrement');

const elemRailIncrements = document.querySelectorAll('.js-rail-increment');
const elemRailDecrements = document.querySelectorAll('.js-rail-decrement');
const elemRailBonuses = document.querySelectorAll('.js-rail-bonus');
const elemRailCounts = document.querySelectorAll('.js-rail-count');
const elemRailScores = document.querySelectorAll('.js-rail-score');

// Update a rail count
function updateRailCount(index, direction) {
  if (direction == 'decrement' && parseInt(elemRailCounts[index].innerHTML) > 0) {
    elemRailCounts[index].innerHTML = parseInt(elemRailCounts[index].innerHTML) - 1
  }
  if (direction == 'increment') {
    elemRailCounts[index].innerHTML = parseInt(elemRailCounts[index].innerHTML) + 1
  }
  if (parseInt(elemRailCounts[index].innerHTML) == 0) {
    toggleLineBonus(index, 'off');
  }
  updateRailScore(index);
}

// Update a rail score
function updateRailScore(index) {
  var bonus = 0;
  var count = parseInt(elemRailCounts[index].innerHTML);
  if (count == 0) {
    elemRailScores[index].innerHTML = 0;
  } else {
    elemRailScores[index].innerHTML = railScoreArray[index] + parseInt(elemRailBonuses[index].dataset.bonus) + count;
  }
  updateTotalScore();
}

// Update a rail line bonus
function toggleLineBonus(index, status) {
  if (status == 'on') {
    elemRailBonuses[index].dataset.bonus = 2;
    elemRailBonuses[index].classList.add("on");
  } else {
    elemRailBonuses[index].dataset.bonus = 0;
    elemRailBonuses[index].classList.remove("on");
  }
}

// Increment rail count
elemRailIncrements.forEach((elemRailIncrement, index) => {
  elemRailIncrement.addEventListener('click', function(e) {
	updateRailCount(index, 'increment');
  });
});

// Decrement rail count
elemRailDecrements.forEach((elemRailDecrement, index) => {
  elemRailDecrement.addEventListener('click', function(e) {
	updateRailCount(index, 'decrement');
  });
});

// Toggle rail bonus
elemRailBonuses.forEach((elemRailBonus, index) => {
  elemRailBonus.addEventListener('click', function(e) {
	if (e.target.dataset.bonus == 0 && parseInt(elemRailCounts[index].innerHTML) > 0) {
      toggleLineBonus(index, 'on');
    } else {
      toggleLineBonus(index, 'off');
    }
  updateRailScore(index);
  });
});

// Toggle dice overrides
elemOverrideControls.forEach((elemOverrideControl) => {
  elemOverrideControl.addEventListener('click', function(e) {
    e.target.classList.toggle("on");
  });
});

// Update the mine count and score
function updateMineScore(direction) {
  if (direction == 'decrement' && parseInt(elemMineCount.innerHTML) > 0) {
    elemMineCount.innerHTML = parseInt(elemMineCount.innerHTML) - 1
  }
  if (direction == 'increment' && parseInt(elemMineCount.innerHTML) < 4) {
    elemMineCount.innerHTML = parseInt(elemMineCount.innerHTML) + 1
  }
  elemMineScore.innerHTML = mineScoreArray[parseInt(elemMineCount.innerHTML)];
}

// Increment mine count
elemMineIncrement.addEventListener('click', function(e) {
  updateMineScore('increment');
  updateTotalScore();
  e.preventDefault();
});

// Decrement mine count
elemMineDecrement.addEventListener('click', function(e) {
  updateMineScore('decrement');
  updateTotalScore();
  e.preventDefault();
});

// Update the total score with all subtotals (lines and mines)
function updateTotalScore() {
  var score = 0;
  elemRailScores.forEach((elemRailScore) => {
    score += parseInt(elemRailScore.innerHTML);
  });
    score += parseInt(elemMineScore.innerHTML);
  elemTotalScore.innerHTML = score;
}

// Reset all scores
elemTotalScore.addEventListener('click', function(e) {
  var result = window.confirm('Reset your score?');
  if (result == true) {
    location.reload();
  } else {
    updateTotalScore();
  }
});
    </script>
  </body>
</html>
